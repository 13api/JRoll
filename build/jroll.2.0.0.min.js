/*! JRoll v2.0.0 ~ (c) 2015-2016 Author:BarZu Git:https://git.oschina.net/chenjianlong/JRoll2/ Website:http://www.chjtx.com/JRoll/ */
;!function(o,r,t){"use strict";function e(o){for(var t;o!==r&&"TEXTAREA"!==o.tagName;){if(t=o.getAttribute("jroll-id"))return v[t];o=o.parentNode}return null}function l(o){var r=e(o.target);r?(u.jrollActive=r,r._start(o)):u.jrollActive=null}function s(o){u.jrollActive&&(u.jrollActive.options.preventDefault&&o.preventDefault(),u.jrollActive._move(o))}function n(){u.jrollActive&&u.jrollActive._end()}function i(o){var r=e(o.target);r&&r._focusin(o)}function a(o){var r=e(o.target);r&&r._focusout()}function c(){setTimeout(function(){for(var o in v)v[o].refresh(),v[o].scrollTo(v[o].x,v[o].y)},600)}var u,d,p="2.0.0",f=4e-4,m=o.requestAnimationFrame||o.webkitRequestAnimationFrame||function(o){setTimeout(o,16)},_=r.createElement("div").style,v={},h=1,x=1;d={computePosition:function(o,r){for(var t=0,e=0;o;)t+=o.offsetLeft,e+=o.offsetTop,o=o.offsetParent,o===r&&(o=null);return{left:t,top:e}},isAndroid:/android/.test(navigator.userAgent.toLowerCase()),TSF:"transform"in _?"transform":"-webkit-transform",TSD:"transitionDuration"in _?"transition-duration":"-webkit-transition-duration",TFO:"transformOrigin"in _?"transform-origin":"-webkit-transform-origin"},r.addEventListener("touchstart",l,!1),r.addEventListener("touchmove",s,!1),r.addEventListener("touchend",n,!1),r.addEventListener("touchcancel",n,!1),o.addEventListener("resize",c,!1),o.addEventListener("orientationchange",c,!1),d.isAndroid&&(r.addEventListener("focusin",i,!1),r.addEventListener("focusout",a,!1)),u=function(o,r){this._init(o,r)},u.version=p,u.utils=d,u.jrollMap=v,u.prototype={_init:function(e,l){var s=this;if(s.wrapper="string"==typeof e?r.querySelector(e):e,s.scroller=l&&l.scroller?"string"==typeof l.scroller?r.querySelector(l.scroller):l.scroller:s.wrapper.children[0],s.scroller.jroll)return s.scroller.jroll.refresh(),s.scroller.jroll;s.scroller.jroll=s,s.wrapperOffset=d.computePosition(s.wrapper,r.body),s.id=l&&l.id||s.scroller.getAttribute("jroll-id")||"jroll_"+t.random().toString().substr(2,8),s.scroller.setAttribute("jroll-id",s.id),v[s.id]=s,s.options={scrollX:!1,scrollY:!0,scrollFree:!1,minX:null,maxX:null,minY:null,maxY:null,zoom:!1,zoomMin:1,zoomMax:4,bounce:!0,scrollBarX:!1,scrollBarY:!1,scrollBarFade:!1,preventDefault:!0,momentum:!0,g:f,autoStyle:!0,adjustTop:190};for(var n in l)"scroller"!==n&&(s.options[n]=l[n]);s.options.autoStyle&&("static"===o.getComputedStyle(s.wrapper).position&&(s.wrapper.style.position="relative"),s.wrapper.style.overflow="hidden",s.scroller.style.minHeight="100%"),s.x=0,s.y=0,s.s=null,s.scrollBarX=null,s.scrollBarY=null,s._s={startX:0,startY:0,lastX:0,lastY:0,endX:0,endY:0},s._z={spacing:0,scale:1,startScale:1},s._event={scrollStart:[],scroll:[],scrollEnd:[],zoomStart:[],zoom:[],zoomEnd:[],refresh:[],touchEnd:[]},s.refresh(!0)},enable:function(){var o=this;return o.scroller.setAttribute("jroll-id",o.id),o},disable:function(){var o=this;return o.scroller.removeAttribute("jroll-id"),o},destroy:function(){var o=this;delete v[o.id],delete o.scroller.jroll,o.disable(),o.scroller.style[tSF]="",o.scroller.style[tSD]="",o.prototype=null;for(var r in o)o.hasOwnProperty(r)&&delete o[r]},call:function(o,r){var t=this;return t._s.lockX=!1,t._s.lockY=!1,t.scrollTo(t.x,t.y),u.jrollActive=o,r&&o._start(r),o},refresh:function(o){var r,e=this;return e.wrapperWidth=e.wrapper.clientWidth,e.wrapperHeight=e.wrapper.clientHeight,e.scrollerWidth=t.round(e.scroller.offsetWidth*e._z.scale),e.scrollerHeight=t.round(e.scroller.offsetHeight*e._z.scale),e.minScrollX=null===e.options.minX?0:e.options.minX,e.maxScrollX=null===e.options.maxX?e.wrapperWidth-e.scrollerWidth:e.options.maxX,e.minScrollY=null===e.options.minY?0:e.options.minY,e.maxScrollY=null===e.options.maxY?e.wrapperHeight-e.scrollerHeight:e.options.maxY,e._s.endX=e.x,e._s.endY=e.y,e.options.scrollBarX?(e.scrollBarX||(r=e._createScrollBar("jroll-xbar","jroll-xbtn",!1),e.scrollBarX=r[0],e.scrollBtnX=r[1]),e.scrollBarScaleX=e.wrapper.clientWidth/e.scrollerWidth,e.scrollBtnX.style.width=t.round(e.scrollBarX.clientWidth*e.scrollBarScaleX)+"px"):e.scrollBarX&&(e.wrapper.removeChild(e.scrollBarX),e.scrollBarX=null),e.options.scrollBarY?(e.scrollBarY||(r=e._createScrollBar("jroll-ybar","jroll-ybtn",!0),e.scrollBarY=r[0],e.scrollBtnY=r[1]),e.scrollBarScaleY=e.wrapper.clientHeight/e.scrollerHeight,e.scrollBtnY.style.height=t.round(e.scrollBarY.clientHeight*e.scrollBarScaleY)+"px"):e.scrollBarY&&(e.wrapper.removeChild(e.scrollBarY),e.scrollBarY=null),o||e._execEvent("refresh"),e},scale:function(o){var r=this,t=parseFloat(o);return isNaN(t)||(r.scroller.style[d.TFO]="0 0",r._z.scale=t,r.refresh().scrollTo(r.x,r.y,400)),r},_focusin:function(o){var r=this;setTimeout(function(){var t,e;r.refresh(),t=d.computePosition(o.target,r.wrapper),e=t.top+r.y,e>r.options.adjustTop&&r.scrollTo(r.x,r.y-e+r.options.adjustTop,400)},600)},_focusout:function(){var o=this;setTimeout(function(){o.refresh(),o.scrollTo(o.x,o.y,400)},600)},_runScrollBarX:function(){var o=this,r=t.round(-1*o.x*o.scrollBarScaleX);o._scrollTo.call({scroller:o.scrollBtnX,_z:{scale:1}},r,0)},_runScrollBarY:function(){var o=this,r=t.round(-1*o.y*o.scrollBarScaleY);o._scrollTo.call({scroller:o.scrollBtnY,_z:{scale:1}},0,r)},_createScrollBar:function(o,t,e){var l,s,n=this;return l=r.createElement("div"),s=r.createElement("div"),l.className=o,s.className=t,this.options.scrollBarX!==!0&&this.options.scrollBarY!==!0||(e?(l.style.cssText="position:absolute;top:2px;right:2px;bottom:2px;width:6px;overflow:hidden;border-radius:2px;-webkit-transform: scaleX(.5);transform: scaleX(.5);",s.style.cssText="background:rgba(0,0,0,.4);position:absolute;top:0;left:0;right:0;border-radius:2px;"):(l.style.cssText="position:absolute;left:2px;bottom:2px;right:2px;height:6px;overflow:hidden;border-radius:2px;-webkit-transform: scaleY(.5);transform: scaleY(.5);",s.style.cssText="background:rgba(0,0,0,.4);height:100%;position:absolute;left:0;top:0;bottom:0;border-radius:2px;")),n.options.scrollBarFade&&(l.style.opacity=0),l.appendChild(s),n.wrapper.appendChild(l),[l,s]},_fade:function(o,r){var t=this;t.fading&&r>0&&(r-=25,r%100===0&&(o.style.opacity=r/1e3),m(t._fade.bind(t,o,r)))},on:function(o,r){var t=this;switch(o){case"scrollStart":t._event.scrollStart.push(r);break;case"scroll":t._event.scroll.push(r);break;case"scrollEnd":t._event.scrollEnd.push(r);break;case"zoomStart":t._event.zoomStart.push(r);break;case"zoom":t._event.zoom.push(r);break;case"zoomEnd":t._event.zoomEnd.push(r);break;case"refresh":t._event.refresh.push(r);break;case"touchEnd":t._event.touchEnd.push(r)}},_execEvent:function(o,r){for(var t=this,e=t._event[o].length-1;e>=0;e--)t._event[o][e].call(t,r)},_compute:function(o,r,e){var l=this;return o>r?l.options.bounce&&o>r+10?t.round(r+(o-r)/4):r:e>o?l.options.bounce&&e-10>o?t.round(e+(o-e)/4):e:o},_scrollTo:function(o,r){this.scroller.style[d.TSF]="translate("+o+"px, "+r+"px) translateZ(0) scale("+this._z.scale+")"},scrollTo:function(o,r,t,e,l){var s=this;return e?(s.x=o,s.y=r):(s.x=o>=s.minScrollX?s.minScrollX:o<=s.maxScrollX?s.maxScrollX:o,s.y=r>=s.minScrollY?s.minScrollY:r<=s.maxScrollY?s.maxScrollY:r),l||(s._s.endX=s.x,s._s.endY=s.y),t&&(s.scroller.style[d.TSD]=t+"ms",setTimeout(function(){s.scroller.style[d.TSD]="0ms"},t)),s._scrollTo(s.x,s.y),s.scrollBtnX&&s._runScrollBarX(),s.scrollBtnY&&s._runScrollBarY(),s},_endAction:function(){var o=this;o._s.endX=o.x,o._s.endY=o.y,o.options.scrollBarFade&&!o.fading&&(o.fading=!0,o.scrollBarX&&o._fade(o.scrollBarX,2e3),o.scrollBarY&&o._fade(o.scrollBarY,2e3)),o._execEvent("scrollEnd")},_stepBounce:function(){var o=this;o.bouncing=!1,4===o.s?1===o.directionY?(o.scrollTo(o.x,o.minScrollY+20,120,!0),o.y=o.minScrollY):(o.scrollTo(o.x,o.maxScrollY-20,120,!0),o.y=o.maxScrollY):3===o.s&&(1===o.directionX?(o.scrollTo(o.minScrollX+20,o.y,120,!0),o.x=o.minScrollX):(o.scrollTo(o.maxScrollX-20,o.y,120,!0),o.x=o.maxScrollX)),setTimeout(function(){o.scrollTo(o.x,o.y,120)},150)},_x:function(o){var r=this,t=r.directionX*o;isNaN(t)||(r.x=r.x+t,(r.x>=r.minScrollX||r.x<=r.maxScrollX)&&(r.moving=!1,r.options.bounce&&(r.bouncing=!0)))},_y:function(o){var r=this,t=r.directionY*o;isNaN(t)||(r.y=r.y+t,(r.y>=r.minScrollY||r.y<=r.maxScrollY)&&(r.moving=!1,r.options.bounce&&(r.bouncing=!0)))},_xy:function(o){var r=this,e=t.round(r.cosX*o),l=t.round(r.cosY*o);isNaN(e)||isNaN(l)||(r.x=r.x+e,r.y=r.y+l,(r.x>=r.minScrollX||r.x<=r.maxScrollX)&&(r.y>=r.minScrollY||r.y<=r.maxScrollY)&&(r.moving=!1))},_step:function(o){var r=this,e=Date.now(),l=e-o,s=0;if(r.bouncing&&r._stepBounce(),!r.moving)return void r._endAction();if(l>16){if(r.speed=r.speed-l*r.options.g,s=t.round(r.speed*l),r.speed<=0||0>=s)return void r._endAction();o=e,r._do(s),r.scrollTo(r.x,r.y,0,!1,!0),r._execEvent("scroll")}m(r._step.bind(r,o))},_doScroll:function(o,r){var t=this;t.distance=o,t.options.bounce&&(t.x=t._compute(t.x,t.minScrollX,t.maxScrollX),t.y=t._compute(t.y,t.minScrollY,t.maxScrollY)),t.scrollTo(t.x,t.y,0,!!t.options.bounce,!0),t._execEvent("scroll",r)},_start:function(o){var r=this,e=o.touches;if(r.count=0,r.moving=!1,!(!r.options.scrollX&&!r.options.scrollY||1!==e.length&&r.options.zoom))return r.s=1,r.startTime=Date.now(),r._s.lastX=r.startPositionX=r._s.startX=e[0].pageX,r._s.lastY=r.startPositionY=r._s.startY=e[0].pageY,void r._execEvent("scrollStart",o);if(r.s=null,r.options.zoom&&e.length>1){r.s=2,r.scroller.style[d.TFO]="0 0";var l=t.abs(e[0].pageX-e[1].pageX),s=t.abs(e[0].pageY-e[1].pageY);return r._z.spacing=t.sqrt(l*l+s*s),r._z.startScale=r._z.scale,r.originX=t.abs(e[0].pageX+e[1].pageX)/2-r.wrapperOffset.left-r.x,r.originY=t.abs(e[0].pageY+e[1].pageY)/2-r.wrapperOffset.top-r.y,void r._execEvent("zoomStart",o)}},_move:function(o){var r,e,l,s,n,i,a,c=this,u=o.touches;if(c.count++,c.count%2!==0){if(r=u[0].pageX,e=u[0].pageY,l=r-c._s.lastX,s=e-c._s.lastY,n=r-c.startPositionX,i=e-c.startPositionY,c._s.lastX=r,c._s.lastY=e,h=l>=0?1:-1,x=s>=0?1:-1,(Date.now()-c.startTime>200||c.directionX!==h||c.directionY!==x)&&(c.startTime=Date.now()-50,c.startPositionX=r,c.startPositionY=e,c.directionX=h,c.directionY=x),1===c.s){if(c.options.scrollBarFade&&(c.fading=!1,c.scrollBarX&&(c.scrollBarX.style.opacity=1),c.scrollBarY&&(c.scrollBarY.style.opacity=1)),!c.options.scrollFree&&c.options.scrollY&&(!c.options.scrollX||t.abs(e-c._s.startY)>=t.abs(r-c._s.startX)))return c._do=c._y,void(c.s=4);if(!c.options.scrollFree&&c.options.scrollX&&(!c.options.scrollY||t.abs(e-c._s.startY)<t.abs(r-c._s.startX)))return c._do=c._x,void(c.s=3);if(c.options.scrollFree)return c._do=c._xy,void(c.s=5)}if(4===c.s)return c.y=e-c._s.startY+c._s.endY,void c._doScroll(i,o);if(3===c.s)return c.x=r-c._s.startX+c._s.endX,void c._doScroll(n,o);if(5===c.s)return c.x=r-c._s.startX+c._s.endX,c.y=e-c._s.startY+c._s.endY,a=t.sqrt(n*n+i*i),c.cosX=n/a,c.cosY=i/a,void c._doScroll(t.sqrt(n*n+i*i),o);if(2===c.s){var d,p=t.abs(u[0].pageX-u[1].pageX),f=t.abs(u[0].pageY-u[1].pageY),m=t.sqrt(p*p+f*f),_=m/c._z.spacing*c._z.startScale;return _<c.options.zoomMin?_=c.options.zoomMin:_>c.options.zoomMax&&(_=c.options.zoomMax),d=_/c._z.startScale,c.x=t.round(c.originX-c.originX*d+c._s.endX),c.y=t.round(c.originY-c.originY*d+c._s.endY),c._z.scale=_,c._scrollTo(c.x,c.y),void c._execEvent("zoom",o)}}},_end:function(){var o,r,e=this,l=4===e.s,s=3===e.s,n=5===e.s;return u.jrollActive=null,e._execEvent("touchEnd"),l||s||n?(e.duration=Date.now()-e.startTime,o=e.y>e.minScrollY||e.y<e.maxScrollY,r=e.x>e.minScrollX||e.x<e.maxScrollX,void(l&&o||s&&r||n&&o&&r?e.scrollTo(e.x,e.y,300,!1)._endAction():e.options.momentum&&e.duration<300?(e.speed=t.abs(e.distance/e.duration),e.speed=e.speed>1?1:e.speed,e.moving=!0,m(e._step.bind(e,Date.now()))):e._endAction())):2===e.s?(e._z.scale>e.options.zoomMax?e._z.scale=e.options.zoomMax:e._z.scale<e.options.zoomMin&&(e._z.scale=e.options.zoomMin),e.refresh(),e.scrollTo(e.x,e.y,400),void e._execEvent("zoomEnd")):void(1!==e.s&&2!==e.s||!e.options.scrollBarFade||e.fading||(e.fading=!0,e.scrollBarX&&e._fade(e.scrollBarX,2e3),e.scrollBarY&&e._fade(e.scrollBarY,2e3)))}},"undefined"!=typeof module&&module.exports&&(module.exports=u),"function"==typeof define&&define(function(){return u}),o.JRoll=u}(window,document,Math);