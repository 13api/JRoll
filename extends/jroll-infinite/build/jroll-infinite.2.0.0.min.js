/*! JRoll-Infinite v2.0.0 ~ (c) 2015-2016 Author:BarZu Git:https://git.oschina.net/chenjianlong/JRoll2/ */
;!function(e,n,t){"use strict";function i(e){var n=e,t="'use strict';\nvar __t='';__t+='",i=0,l=/\{\{=([^\{]+)\}\}|\{\{(each [\w\$\._]+ as [\w\$_]+ [\w\$_]+)\}\}|\{\{if ([^\{]+)\}\}|\{\{(else)\}\}|\{\{else if ([^\{]+)\}\}|(\{\{\/each\}\}|\{\{\/if\}\})|\{\{([^\{]+)\}\}/g;return n=n.replace(/(\n|\r)|(\{\{\s+)|(\s+\}\})|(\s{2,})|(')/g,function(e,n,t,i,l,o){var r;return n?r="":t?r="{{":i?r="}}":l?r=" ":o&&(r="\\'"),r}),n.replace(l,function(e,l,o,r,a,s,c,p,f){if(t+=n.slice(i,f),i=f+e.length,l)t+="'+("+l.replace(/\\\'/g,"'")+")+'";else if(o){var g=o.split(" ");t+="';\nfor(var "+g[4]+"=0,"+g[3]+";"+g[4]+"<"+g[1]+".length;"+g[4]+"++){\n"+g[3]+"="+g[1]+"["+g[4]+"];\n__t+='"}else r?t+="';\nif("+r.replace(/\\\'/g,"'")+"){\n__t+='":a?t+="';\n}else{\n__t+='":s?t+="';\n}else if("+s.replace(/\\\'/g,"'")+"){\n__t+='":c?t+="';\n};\n__t+='":p&&(t+="';\n"+p.replace(/\\\'/g,"'")+";\n__t+='");return e}),t+=n.slice(i)+"';return __t;",new Function("_obj",t)}function l(e,n){return e(n)}t.prototype.infinite=function(e){function t(e){return e.replace(/("|')|\$|\(|\)|\+|\*|\.|\[|\]|\?|\\|\^|\{|\}|\|/g,function(e,n){return n?"[\"']":"\\"+e})}function o(e){var n;if(a=!1,e){n="<section class='jroll-infinite-page'>";for(var t=0,i=e.length;t<i;t++)n+=g.render(s,e[t],t);n+="</section>",n+=g.total===p.options.page?g.completeTip:g.loadingTip,p.scroller.innerHTML=p.scroller.innerHTML.replace(c,"")+n,p.refresh(),setTimeout(function(){var e=p.scroller.querySelectorAll(".jroll-infinite-page"),n=e[e.length-1];n&&(n.style.height=n.offsetHeight+"px"),r(e)},10)}}function r(e){if(g.blank)for(var n=e||p.scroller.querySelectorAll(".jroll-infinite-page"),t=p.wrapper.clientHeight,i=p.y,l=0,o=n.length;l<o;l++)n[l].offsetTop-t+i>0||n[l].offsetTop+n[l].offsetHeight+i<0?n[l].classList.add("jroll-infinite-hide"):n[l].classList.remove("jroll-infinite-hide")}var a,s,c,p=this,f=Object.keys(e||{}),g={total:99,getData:null,blank:!1,template:"",loadingTip:'<div class="jroll-infinite-tip">正在加载...</div>',completeTip:'<div class="jroll-infinite-tip">已加载全部内容</div>',compile:i,render:l};for(var u in f)g[f[u]]=e[f[u]];p.options.total=g.total,p.options.page=1,p.infinite_callback=o,s=g.compile(g.template);var d=n.getElementById("jroll_style"),_="\n/* jroll-infinite */\n.jroll-infinite-hide>*{display:none}\n";d?/jroll-infinite/.test(d.innerHTML)||(d.innerHTML+=_):(d=n.createElement("style"),d.id="jroll_style",d.innerHTML=_,n.head.appendChild(d)),n.createElement("div").innerHTML=g.loadingTip+g.completeTip,"function"==typeof g.getData&&(p.scroller.innerHTML=g.loadingTip,g.getData(p.options.page,o)),c=new RegExp("("+t(g.loadingTip)+"|"+t(g.completeTip)+")","g"),p.on("scrollEnd",function(){p.y<p.maxScrollY+p.scroller.querySelector(".jroll-infinite-tip").offsetHeight&&p.options.page!==p.options.total&&!a&&(a=!0,g.getData(++p.options.page,o)),r()})},"undefined"!=typeof module&&module.exports&&(module.exports=t),"function"==typeof define&&define(function(){return t})}(window,document,JRoll);